<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Data Pelanggan Laundry</title>
  <style>
    /* ... (gunakan CSS yang sama dari sebelumnya) ... */
  </style>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>

<!-- Login -->
<div class="container" id="login-container">
  <h1>Login Pelanggan</h1>
  <form id="login-form">
    <input type="text" id="login-nama" placeholder="Masukkan Nama Anda" required />
    <input type="text" id="login-kode" placeholder="Masukkan Kode Transaksi" required />
    <button type="submit">Lihat Data Saya</button>
  </form>
</div>

<!-- Data -->
<div class="container" id="data-container" style="display:none;">
  <h1>Data Laundry Anda</h1>
  <div class="error-message" id="error-message" style="display:none;">
    Gagal memuat data. Silakan cek kembali informasi login Anda.
  </div>
  <table id="laundryTable">
    <thead>
      <tr>
        <th>Nama</th>
        <th>Harga</th>
        <th>Jumlah</th>
        <th>Berat</th>
        <th>Layanan</th>
        <th>Tanggal Masuk</th>
        <th>Tanggal Selesai</th>
        <th>Kode</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyA0nLjuJd1cah3yHkcWLNvmqPA5cAnSOjI",
    authDomain: "tongsampah1-a.firebaseapp.com",
    databaseURL: "https://tongsampah1-a-default-rtdb.firebaseio.com",
    projectId: "tongsampah1-a",
    storageBucket: "tongsampah1-a.appspot.com",
    messagingSenderId: "631897766480",
    appId: "1:631897766480:web:b12b5adc1f1d48d20f2f55"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  function formatRupiah(angka) {
    return 'Rp ' + parseInt(angka || 0).toLocaleString('id-ID');
  }

  $('#login-form').on('submit', function(e) {
    e.preventDefault();
    const nama = $('#login-nama').val().trim().toLowerCase();
    const kode = $('#login-kode').val().trim();

    db.ref('databasee/' + kode).once('value')
      .then(snapshot => {
        const data = snapshot.val();
        if (!data || (data.nama || '').toLowerCase() !== nama) {
          $('#error-message').show();
          return;
        }

        $('#error-message').hide();
        $('#login-container').hide();
        $('#data-container').show();

        const row = `
          <tr>
            <td>${data.nama || '-'}</td>
            <td>${formatRupiah(data.harga)}</td>
            <td>${data.jumlah || '0'}</td>
            <td>${data.berat || '0'}</td>
            <td>${data.layanan || '-'}</td>
            <td>${data.tanggal || '-'}</td>
            <td>${data.tanggalPengambilan || '-'}</td>
            <td>${data.code || '-'}</td>
            <td>${data.status || 'On Proses'}</td>
          </tr>
        `;
        $('#laundryTable tbody').html(row);
      })
      .catch(err => {
        console.error("Gagal mengambil data:", err);
        $('#error-message').show();
      });
  });
</script>

</body>
</html>
